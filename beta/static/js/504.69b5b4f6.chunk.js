"use strict";(self.webpackChunkbeta_src=self.webpackChunkbeta_src||[]).push([[504],{2825:function(r,e,t){t.r(e),t.d(e,{default:function(){return or}});var n=t(885),i=t(2791),o=t(4194);var a=t(3967),c=t(6920),s=t(2048),l=t(184),u=function(){return(0,l.jsx)("rect",{className:"trigger",height:"100%",width:"100%",fill:"black",style:{opacity:0}})},d=function(r){var e=r.province,t=r.x,n=r.y,i=(0,a.Z)();return(0,l.jsxs)("svg",{id:"".concat(e,"-center"),width:"34",height:"34",viewBox:"0 0 34 34",fill:"none",x:t,y:n,xmlns:"http://www.w3.org/2000/svg",children:[(0,l.jsx)("path",{d:"M17 32.9998C25.8366 32.9998 33 25.8364 33 16.9999C33 8.1634 25.8366 1 17 1C8.16344 1 1 8.1634 1 16.9999C1 25.8364 8.16344 32.9998 17 32.9998Z",stroke:i.palette.primary.main}),(0,l.jsx)("path",{d:"M17.0064 25.7269C21.8263 25.7269 25.7336 21.8196 25.7336 16.9997C25.7336 12.1797 21.8263 8.27243 17.0064 8.27243C12.1866 8.27243 8.2793 12.1797 8.2793 16.9997C8.2793 21.8196 12.1866 25.7269 17.0064 25.7269Z",fill:i.palette.primary.main}),(0,l.jsx)(u,{})]})},h=t(1413),f=function(r){var e=r.id,t=r.style,n=r.text,i=r.x,o=r.y,c=(0,a.Z)();return(0,l.jsx)("text",{className:"label",style:(0,h.Z)({fill:c.palette.primary.main,fontWeight:900,fontSize:"150%",userSelect:"none"},t),x:i,y:o,id:e,children:n},e)};f.defaultProps={id:void 0};var v,y=f,p=function(r){var e,t=r.provinceMapData,n=r.ownerCountryID,i=r.playerCountryID,o=r.highlightSelection,u=(0,a.Z)(),h=(0,s.T)(),f=(0,s.C)(c.vq),v=(f.user,f.members),p=t.province,m="none",x=0;if(n){var D,I,g=null===(D=v.find((function(r){return r.countryID===Number(n)})))||void 0===D?void 0:D.country;if(g&&"Sea"!==t.type)m=null===(I=u.palette[g])||void 0===I?void 0:I.main,x=.4}if(o&&i){var Z,O,P=null===(Z=v.find((function(r){return r.countryID===i})))||void 0===Z?void 0:Z.country;if(P)m=null===(O=u.palette[P])||void 0===O?void 0:O.main,x=1}return(0,l.jsxs)("svg",{height:t.height,id:"".concat(p,"-province"),viewBox:t.viewBox,width:t.width,x:t.x,y:t.y,children:[(0,l.jsxs)("g",{onClick:function(r){return e=r,void h(c.I9.processMapClick({evt:e,clickProvince:p}));var e},children:[(null===(e=t.texture)||void 0===e?void 0:e.texture)&&(0,l.jsx)("path",{d:t.path,fill:t.texture.texture,id:"".concat(p,"-texture"),stroke:t.texture.stroke,strokeOpacity:t.texture.strokeOpacity,strokeWidth:t.texture.strokeWidth}),(0,l.jsx)("path",{d:t.path,fill:m,fillOpacity:x,id:"".concat(p,"-control-path"),stroke:u.palette.primary.main,strokeOpacity:1,strokeWidth:1})]}),t.centerPos&&(0,l.jsx)("g",{className:"no-pointer-events",children:(0,l.jsx)(d,{province:p,x:t.centerPos.x,y:t.centerPos.y})}),t.labels&&t.labels.map((function(r,e){var n=r.name,i=r.text,o=r.style,a=r.x,c=r.y,s=i,u="".concat(p,"-label-").concat(n);return s||(s=t.abbr),(0,l.jsx)("g",{className:"no-pointer-events",children:(0,l.jsx)(y,{id:u,name:n,style:o,text:s,x:a,y:c},u||e)},u)}))]})},m=function(r){var e=r.provinceMapData,t=e.province;return(0,l.jsx)("svg",{height:e.height,id:"".concat(t,"-province-overlay"),viewBox:e.viewBox,width:e.width,x:e.x,y:e.y,overflow:"visible",children:(0,l.jsx)("path",{d:e.path,fill:"none",fillOpacity:0,id:"".concat(t,"-choice-outline"),stroke:"black",strokeOpacity:1,strokeWidth:5})})},x=t(5824),D=t(5734),I=function(r){var e=r.children,t=r.name,n=r.x,i=r.y;return(0,l.jsx)("svg",{className:"unit-slot",id:"".concat(t,"-unit-slot"),style:{overflow:"visible"},x:n,y:i,children:e})},g=t(3861),Z=function(r){var e=r.provinceMapData,t=r.units,n=e.province,i={},o={};return t.filter((function(r){return r.mappedTerritory.province===n})).forEach((function(r){var e;switch(r.drawMode){case g.OA.NONE:e=x.Z.NONE;break;case g.OA.HOLD:e=x.Z.HOLD;break;case g.OA.BUILD:case g.OA.DISLODGING:e=x.Z.NONE;break;case g.OA.DISLODGED:e=x.Z.DISLODGED;break;case g.OA.DISBANDED:e=x.Z.DISBANDED;break;default:e=x.Z.NONE}var t=(0,l.jsx)(D.ZP,{id:"".concat(n,"-unit"),country:r.country,meta:r,type:r.unit.type,iconState:e});r.drawMode===g.OA.DISLODGING?o[r.mappedTerritory.unitSlotName]=t:i[r.mappedTerritory.unitSlotName]=t})),(0,l.jsxs)("svg",{height:e.height,id:"".concat(n,"-province-overlay"),viewBox:e.viewBox,width:e.width,x:e.x,y:e.y,overflow:"visible",children:[e.unitSlots.filter((function(r){return r.name in i})).map((function(r){var e=r.name,t=r.x,n=r.y;return(0,l.jsx)(I,{name:e,x:t,y:n,children:i[e]},e)})),e.unitSlots.filter((function(r){return r.name in o})).map((function(r){var e=r.name,t=r.arrowReceiver,n="".concat(e,"-dislodging");return(0,l.jsx)(I,{name:n,x:t.x,y:t.y,children:o[e]},n)}))]})},O=t(5230),P=t(9234),S=t(5963),T=function(r){var e=r.units,t=r.centersByProvince,n=r.phase,i=r.isLivePhase,o=(0,s.C)(c.BU),a=(0,s.C)(c.Jw),u={};o.data.territoryStatuses.forEach((function(r){u[a.terrIDToProvince[r.id]]=r}));var d=(0,s.C)(c.RY),h=(0,s.C)(c.Jr),f=(0,s.C)(c.vq),v=(f.members,f.user),y=[],x=[];i&&v&&("Diplomacy"===n?d.inProgress?"Move"===d.type?d.viaConvoy?(y=[a.terrIDToProvince[a.unitToTerrID[d.unitID]]],x=h.legalViasByUnitID[d.unitID].map((function(r){return S.ZP[r.dest].province}))):(y=[a.terrIDToProvince[a.unitToTerrID[d.unitID]]],x=h.legalMoveDestsByUnitID[d.unitID].map((function(r){return S.ZP[r].province}))):"Support"===d.type?d.fromTerrID?(y=[a.terrIDToProvince[a.unitToTerrID[d.unitID]],a.terrIDToProvince[d.fromTerrID]],x=h.legalSupportsByUnitID[d.unitID][a.terrIDToProvince[d.fromTerrID]].map((function(r){return r.dest}))):(y=[a.terrIDToProvince[a.unitToTerrID[d.unitID]]],x=Object.keys(h.legalSupportsByUnitID[d.unitID])):"Convoy"===d.type&&(d.fromTerrID?(y=[a.terrIDToProvince[a.unitToTerrID[d.unitID]],a.terrIDToProvince[d.fromTerrID]],x=Object.keys(h.legalConvoysByUnitID[d.unitID][a.terrIDToProvince[d.fromTerrID]])):(y=[a.terrIDToProvince[a.unitToTerrID[d.unitID]]],x=Object.keys(h.legalConvoysByUnitID[d.unitID]))):(y=[],x=[]):"Retreats"===n?d.inProgress?"Retreat"===d.type&&(y=[a.terrIDToProvince[a.unitToTerrID[d.unitID]]],(x=h.legalRetreatDestsByUnitID[d.unitID].map((function(r){return S.ZP[r].province}))).push(y[0])):(y=[],x=Object.keys(h.legalRetreatDestsByUnitID).map((function(r){return a.terrIDToProvince[a.unitToTerrID[r]]}))):"Builds"===n&&(v.member.supplyCenterNo<v.member.unitNo?x=e.filter((function(r){return r.country===v.member.country})).map((function(r){return r.mappedTerritory.province})):v.member.supplyCenterNo>v.member.unitNo&&(x=h.possibleBuildDests.map((function(r){return S.ZP[r].province})))));var D=new Set(y),I=new Set(x),g=Object.values(O.Z).filter((function(r){return!r.playable})).map((function(r){var e;return(0,l.jsx)(p,{provinceMapData:r,ownerCountryID:null===(e=t[r.province])||void 0===e?void 0:e.ownerCountryID,playerCountryID:null===v||void 0===v?void 0:v.member.countryID,highlightSelection:!1},"".concat(r.province,"-province"))})),T=Object.values(O.Z).filter((function(r){return r.playable&&r.province!==P.Z.NAPLES&&r.province!==P.Z.ROME}));T.push(O.Z[P.Z.NAPLES]),T.push(O.Z[P.Z.ROME]);var w=T.map((function(r){var e,n=D.has(r.province);return(0,l.jsx)(p,{provinceMapData:r,ownerCountryID:null===(e=t[r.province])||void 0===e?void 0:e.ownerCountryID,playerCountryID:null===v||void 0===v?void 0:v.member.countryID,highlightSelection:n},"".concat(r.province,"-province"))})),j=T.filter((function(r){return I.has(r.province)})).map((function(r){return(0,l.jsx)(m,{provinceMapData:r},"".concat(r.province,"-province-border-highlight"))})),k=T.map((function(r){return(0,l.jsx)(Z,{provinceMapData:r,units:e},"".concat(r.province,"-province-overlay"))}));return(0,l.jsxs)("g",{id:"wD-boardmap-v10.3.4 1",children:[(0,l.jsx)("g",{id:"unplayable",children:g}),(0,l.jsx)("g",{id:"playableProvinces",children:w}),(0,l.jsx)("g",{id:"playableProvinceBorderHighlights",children:j}),(0,l.jsx)("g",{id:"playableProvinceOverlays",children:k})]})},w=t.p+"static/media/capturable-land.379f9cca7138664bf782.jpeg",j=t.p+"static/media/sea-texture.fd82ad462f655f49e1f0.png",k=t(4375);!function(r){r[r.CONVOY=0]="CONVOY",r[r.MOVE=1]="MOVE",r[r.SUPPORT=2]="SUPPORT",r[r.HOLD=3]="HOLD"}(v||(v={}));var E,b=v,C=t(5173),M=function(r){switch(r){case b.SUPPORT:return(0,l.jsx)(l.Fragment,{children:Object.entries(C.Z.palette.arrowColors).map((function(e){var t=(0,n.Z)(e,2),i=t[0],o=t[1];return(0,l.jsxs)("marker",{id:"arrowHead__".concat(b[r],"_").concat(k.Z[i]),markerWidth:12,markerHeight:8,refX:18,refY:3,orient:"auto",children:[(0,l.jsx)("polygon",{points:"0 0, 6 3, 0 6, 0 5, 4 3, 0 1",fill:o.main}),(0,l.jsx)("polygon",{points:"4 0, 10 3, 4 6, 4 5, 8 3, 4 1",fill:o.main})]},"arrowHead__".concat(b[r],"_").concat(k.Z[i]))}))});case b.HOLD:return(0,l.jsx)(l.Fragment,{children:Object.entries(C.Z.palette.arrowColors).map((function(e){var t=(0,n.Z)(e,2),i=t[0],o=t[1];return(0,l.jsx)("marker",{id:"arrowHead__".concat(b[r],"_").concat(k.Z[i]),markerWidth:90,markerHeight:90,refX:10,refY:45,orient:"auto",markerUnits:"userSpaceOnUse",strokeWidth:4,children:(0,l.jsx)("path",{d:" M 24 72 A 30 30 180 0 1 24 18",stroke:o.main})},"arrowHead__".concat(b[r],"_").concat(k.Z[i]))}))});default:return(0,l.jsx)(l.Fragment,{children:Object.entries(C.Z.palette.arrowColors).map((function(e){var t=(0,n.Z)(e,2),i=t[0],o=t[1];return(0,l.jsx)("marker",{id:"arrowHead__".concat(b[r],"_").concat(k.Z[i]),markerWidth:8,markerHeight:8,refX:i===k.Z.IMPLIED_FOREIGN?0:7.1,refY:4,orient:"auto",children:(0,l.jsx)("polygon",{points:"0 0, 8 4, 0 8",fill:o.main})},"arrowHead__".concat(b[r],"_").concat(k.Z[i]))}))})}},B=function(){return(0,l.jsxs)(l.Fragment,{children:[M(b.HOLD),M(b.MOVE),M(b.SUPPORT)]})},N=t(4942),A=t(4554);!function(r){r[r.Army=2]="Army",r[r.Fleet=4]="Fleet",r[r.All=6]="All"}(E||(E={}));var L,_,R=E,F=(L={Army:R.Army,Fleet:R.Fleet},(0,N.Z)(L,R.Army,"Army"),(0,N.Z)(L,R.Fleet,"Fleet"),_={},(0,N.Z)(_,R.Army,"Build Army"),(0,N.Z)(_,R.Fleet,"Build Fleet"),(0,N.Z)(_,"Build Army",R.Army),(0,N.Z)(_,"Build Fleet",R.Fleet),_),U=t(5469),H=t(4861),V=t(9018),G=function(r){var e=r.availableOrder,t=r.clickCallback,n=r.country,i=r.canBuild,o=r.province,a=r.unitSlotName,c=r.toTerrID,s=O.Z[o],u=s.x+s.unitSlotsBySlotName[a].x,d=s.y+s.unitSlotsBySlotName[a].y,h=70,f=[],v={width:50,height:50},y={cursor:"pointer"},p=0+h/2,m=p-25;if(d-=70,i&R.Army&&f.push((0,l.jsxs)("g",{style:y,onClick:function(){t(e,R.Army,c)},children:[(0,l.jsx)("circle",{fill:"white",r:25,cx:p,cy:35}),(0,l.jsx)("svg",{x:m,y:10,style:v,children:(0,l.jsx)(H.ZP,{country:n,iconState:x.Z.BUILD})})]},"Army")),i&R.Fleet){var D=0;f.length&&(D=h-10,h=2*h-10),f.push((0,l.jsxs)("g",{style:y,onClick:function(){t(e,R.Fleet,c)},children:[(0,l.jsx)("circle",{fill:"white",r:25,cx:p+D,cy:35}),(0,l.jsx)("svg",{x:m+D,y:10,style:v,children:(0,l.jsx)(V.ZP,{country:n,iconState:x.Z.BUILD})})]},"Fleet"))}return u-=h/2,(0,l.jsxs)("svg",{x:u,y:d,children:[(0,l.jsx)("rect",{x:0,y:0,fill:"rgba(0,0,0,.7)",width:h,height:70,rx:10,ry:10}),f]})},Y=function(){var r=(0,s.T)(),e=(0,s.C)(c.Jw),t=(0,s.C)(c.RY),n=(0,s.C)((function(r){return r.game.overview.user.member}));if(!t||"Build"!==t.type)return(0,l.jsx)(A.Z,{});var i=e.terrIDToTerritory[t.toTerrID],o=S.ZP[i],a=o.province,u=o.unitSlotName,d="Coast"===O.Z[a].type?R.All:R.Army;return(0,l.jsx)(G,{availableOrder:t.orderID,canBuild:d,clickCallback:function(t,n,i){var o=i;"Build Army"===F[n]&&(o=e.terrIDToProvinceID[i]),r(c.I9.updateOrdersMeta((0,N.Z)({},t,{saved:!1,update:{type:F[n],toTerrID:o}}))),r(c.I9.resetOrder())},country:U.Z[n.country],province:a,unitSlotName:u,toTerrID:t.toTerrID},"".concat(a,"-").concat(u))},W=function(r){var e=r.province,t=r.unitSlotName,n=r.position,i=r.text,o=r.clickHandler,a=((0,s.T)(),O.Z[e]);if(!a||!a.unitSlotsBySlotName[t])return(0,l.jsx)(A.Z,{});var c=a.x+a.unitSlotsBySlotName[t].x,u=a.y+a.unitSlotsBySlotName[t].y,d=55+28*i.length*.4,h=0,f=0;if("top"===n)f=-86.5;else if("bottom"===n)f=86.5;else if("left"===n)h=-(d/2+50);else{if("right"!==n)throw Error(n);h=+(d/2+50)}var v=c-d/2+h,y=u-36.5+f;return(0,l.jsx)("svg",{x:v,y:y,filter:"drop-shadow(10px 10px 18px #222222)",onClick:o,children:(0,l.jsxs)("g",{style:{cursor:"pointer"},children:[(0,l.jsx)("rect",{x:0,y:0,fill:"white",width:d,height:73,rx:35,ry:35}),(0,l.jsx)("text",{x:d/2,y:36.5,textAnchor:"middle",alignmentBaseline:"middle",fontFamily:"Roboto",fontSize:28,style:{userSelect:"none"},fill:"black",children:i})]})})},z=function(r){var e,t,n=r.units,i=(0,s.T)(),o=(0,s.C)(c.RY),a=(0,s.C)(c.Jw),u=(0,s.C)(c.Jr);if(!o.inProgress||o.type||!o.unitID)return(0,l.jsx)(A.Z,{});var d=n.find((function(r){return r.unit.id===o.unitID})),h=S.ZP[a.unitToTerritory[o.unitID]],f=h.province,v=h.unitSlotName,y=function(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return function(){i(c.I9.updateOrder({type:r,viaConvoy:e}))}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(W,{province:f,unitSlotName:v,position:"left",text:"Hold",clickHandler:y("Hold")}),(0,l.jsx)(W,{province:f,unitSlotName:v,position:"right",text:"Move",clickHandler:y("Move")}),(0,l.jsx)(W,{province:f,unitSlotName:v,position:"top",text:"Support",clickHandler:y("Support")}),"Fleet"===(null===d||void 0===d||null===(e=d.unit)||void 0===e?void 0:e.type)&&"Sea"===h.provinceMapData.type&&u.hasAnyLegalConvoysByUnitID[o.unitID]&&(0,l.jsx)(W,{province:f,unitSlotName:v,position:"bottom",text:"Convoy",clickHandler:y("Convoy")})||(0,l.jsx)("g",{}),"Army"===(null===d||void 0===d||null===(t=d.unit)||void 0===t?void 0:t.type)&&u.legalViasByUnitID[o.unitID].length>0&&(0,l.jsx)(W,{province:f,unitSlotName:v,position:"bottom",text:"Via Convoy",clickHandler:y("Move","Yes")})]})},J=t(2750);function X(r,e){var t,i,o,a;switch(r){case"arrow":var c=e,s=(0,n.Z)(c,4),l=s[0],u=s[1];t=l+.75*(s[2]-l),i=u+.75*(s[3]-u),o=0,a=0;break;case"unit":var d=J.Z[e],h=S.ZP[d].provinceMapData,f=S.ZP[d].unitSlotName;t=h.x,i=h.y,h.unitSlotsBySlotName[f]&&(t+=h.unitSlotsBySlotName[f].x,i+=h.unitSlotsBySlotName[f].y),o=D.Vd,a=D.Lz;break;case"dislodger":var v=J.Z[e],y=S.ZP[v].provinceMapData,p=S.ZP[v].unitSlotName;t=y.x,i=y.y,y.unitSlotsBySlotName[p]&&(t+=y.unitSlotsBySlotName[p].arrowReceiver.x,i+=y.unitSlotsBySlotName[p].arrowReceiver.y),o=D.Vd,a=D.Lz;break;default:var m=J.Z[e],x=S.ZP[m].provinceMapData,I=S.ZP[m].unitSlotName;t=x.x,i=x.y,x.unitSlotsBySlotName[I]&&(t+=x.unitSlotsBySlotName[I].arrowReceiver.x,i+=x.unitSlotsBySlotName[I].arrowReceiver.y),o=12,a=12}return[t,i,o,a]}function q(r,e,t,i){var o=X(r,e),a=(0,n.Z)(o,4),c=a[0],s=a[1],l=a[2],u=a[3],d=X(t,i),h=(0,n.Z)(d,4),f=h[0],v=h[1],y=h[2];"unit"!==r&&"dislodger"!==r||(l*=.8,u*=.8);var p=function(r,e,t,n,i,o,a,c){var s=o-i,l=c-a;if(Math.abs(s)<=1e-10&&Math.abs(l)<=1e-10)return{x1:i,x2:o,y1:a,y2:c};var u=Math.atan2(l,s),d=i+e/2*Math.cos(u),h=a+r/2*Math.sin(u),f=o-n/2*Math.cos(u),v=c-t/2*Math.sin(u);return(f-d)*s+(v-h)*l<=1e-10?{x1:i,x2:o,y1:a,y2:c}:{x1:d,x2:f,y1:h,y2:v}}(u,l,h[3],y,c,f,s,v),m=p.x1,x=p.x2;return[m,p.y1,x,p.y2]}function K(r,e,t,i,o,a){var c,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,d=q(t,i,o,a),h=(0,n.Z)(d,4),f=h[0],v=h[1],y=h[2],p=h[3];switch(r===b.CONVOY?c="4 3":r===b.HOLD&&(c="12 3"),e){case k.Z.MOVE:case k.Z.CONVOY:case k.Z.IMPLIED:case k.Z.IMPLIED_FOREIGN:case k.Z.RETREAT:case k.Z.SUPPORT_HOLD:case k.Z.SUPPORT_MOVE:s=3.5;break;case k.Z.MOVE_FAILED:case k.Z.CONVOY_FAILED:case k.Z.SUPPORT_HOLD_FAILED:case k.Z.SUPPORT_MOVE_FAILED:s=3;break;default:s=3.5}if(u>0){var m=y-f,x=p-v,D=Math.sqrt(m*m+x*x);if(D>0){var I=m/D,g=x/D,Z=-I;f+=u*g,v+=u*Z}}return(0,l.jsx)("line",{x1:f,y1:v,x2:y,y2:p,markerEnd:"url(#arrowHead__".concat(b[r],"_").concat(k.Z[e],")"),stroke:C.Z.palette.arrowColors[e].main,strokeWidth:s,strokeDasharray:c},"".concat(f,"-").concat(v,"-").concat(y,"-").concat(p,"-").concat(r,"-").concat(e))}function Q(r,e){var t;return null!==(t=e[r])&&void 0!==t&&t.coastParentID?Number(e[r].coastParentID):r}var $=function(r){var e=r.orders,t=r.units,i=(r.maps,r.territories),o=r.standoffs,a=[],c={};e.forEach((function(r){c[Q(r.terrID,i)]=r}));var s=new Set;return function(r,e,t){e.filter((function(r){return"Move"===r.type})).forEach((function(e){if(e.toTerrID){var n=S.ZP[t[e.terrID].name].territory,i=S.ZP[t[e.toTerrID].name].territory;r.push(K(b.MOVE,"Yes"===e.success?k.Z.MOVE:k.Z.MOVE_FAILED,"unit",n,"territory",i)),e.viaConvoy}}))}(a,e,i),function(r,e,t,n){var i={};e.filter((function(r){return"Support hold"===r.type})).forEach((function(r){var e=Q(r.terrID,n),t=r.toTerrID;i[e]=t})),e.filter((function(r){return"Support hold"===r.type})).forEach((function(e){if(e.toTerrID){var o=Q(e.terrID,n),a=S.ZP[n[e.terrID].name].territory,c=e.toTerrID,s=t[c],l=s?S.ZP[n[s.terrID].name].territory:S.ZP[n[e.toTerrID].name].territory,u="Yes"===e.success?k.Z.SUPPORT_HOLD:k.Z.SUPPORT_HOLD_FAILED,d=i[c]===o?6:0;r.push(K(b.HOLD,u,"unit",a,"unit",l,d))}}))}(a,e,c,i),function(r,e,t,n,i){e.filter((function(r){return"Support move"===r.type})).forEach((function(e){if(e.fromTerrID&&e.toTerrID){var o=S.ZP[n[e.terrID].name].territory,a=!1,c=e.fromTerrID,s=t[c];!s||"Move"!==s.type||s.terrID!==e.fromTerrID&&n[s.terrID].coastParentID!==e.fromTerrID.toString()||s.toTerrID!==e.toTerrID&&n[s.toTerrID].coastParentID!==e.toTerrID.toString()||(a=!0);var l=s?S.ZP[n[s.terrID].name].territory:S.ZP[n[e.fromTerrID].name].territory,u="Yes"===e.success?k.Z.SUPPORT_MOVE:k.Z.SUPPORT_MOVE_FAILED;if(a){var d=S.ZP[n[s.toTerrID].name].territory;r.push(K(b.SUPPORT,u,"unit",o,"arrow",q("unit",l,"territory",d)))}else{var h=S.ZP[n[e.toTerrID].name].territory;r.push(K(b.SUPPORT,u,"unit",o,"arrow",q("unit",l,"territory",h)));var f="".concat(l,"|").concat(h);i.has(f)||(i.add(f),r.push(K(b.MOVE,k.Z.IMPLIED_FOREIGN,"unit",l,"territory",h)))}}}))}(a,e,c,i,s),function(r,e,t,n,i){e.filter((function(r){return"Convoy"===r.type})).forEach((function(e){if(e.fromTerrID&&e.toTerrID){var o=S.ZP[n[e.terrID].name].territory,a=S.ZP[n[e.fromTerrID].name].territory,c=!1,s=t[e.fromTerrID];!s||"Move"!==s.type||s.terrID!==e.fromTerrID||s.toTerrID!==e.toTerrID&&n[s.toTerrID].coastParentID!==e.toTerrID.toString()||(c=!0);var l="Yes"===e.success?k.Z.CONVOY:k.Z.CONVOY_FAILED,u=S.ZP[n[e.toTerrID].name].territory;if(r.push(K(b.CONVOY,l,"unit",o,"arrow",q("unit",a,"territory",u))),!c){var d="".concat(a,"|").concat(u);i.has(d)||(i.add(d),r.push(K(b.MOVE,k.Z.IMPLIED_FOREIGN,"unit",a,"territory",u)))}}}))}(a,e,c,i,s),function(r,e,t){e.filter((function(r){return"Retreat"===r.type})).forEach((function(e){if(e.toTerrID){var n=S.ZP[t[e.terrID].name].territory,i=S.ZP[t[e.toTerrID].name].territory;r.push(K(b.MOVE,k.Z.RETREAT,"unit",n,"territory",i))}}))}(a,e,i),function(r,e,t){e.filter((function(r){return r.drawMode===g.OA.DISLODGING})).forEach((function(e){if(null!==e.movedFromTerrID){var n=S.ZP[t[e.movedFromTerrID].name].territory,i=S.ZP[t[e.unit.terrID].name].territory;r.push(K(b.MOVE,k.Z.MOVE,"territory",n,"dislodger",i))}}))}(a,t,i),function(r,e,t){e.filter((function(r){return r.drawMode===g.OA.BUILD})).forEach((function(e){var i=S.ZP[t[e.unit.terrID].name].territory,o=X("unit",i),a=(0,n.Z)(o,4),c=a[0],s=a[1],u=a[2],d=a[3];r.push((0,l.jsx)("circle",{cx:c,cy:s,r:1.4*(u+d)/4,fill:"none",stroke:"rgb(0,150,0)",strokeWidth:.05*(u+d)},"build-circle-".concat(i)))}))}(a,t,i),function(r,e,t){e.filter((function(r){return r.drawMode===g.OA.DISBANDED})).forEach((function(e){var i=S.ZP[t[e.unit.terrID].name].territory,o=X("unit",i),a=(0,n.Z)(o,4),c=a[0],s=a[1],u=(a[2],a[3],38);r.push((0,l.jsx)("line",{x1:c-u,y1:s-u,x2:c+u,y2:s+u,stroke:"red",strokeWidth:4},"disbandmark-".concat(i,"-1"))),r.push((0,l.jsx)("line",{x1:c+u,y1:s-u,x2:c-u,y2:s+u,stroke:"red",strokeWidth:4},"disbandmark-".concat(i,"-2")))}))}(a,t,i),function(r,e){e.forEach((function(e){var t=e.province,i=O.Z[t].rootTerritory;if(i){var o=X("territory",i),a=(0,n.Z)(o,4),c=a[0],s=a[1],u=(a[2],a[3],15);r.push((0,l.jsx)("line",{x1:c-u,y1:s-u,x2:c+u,y2:s+u,stroke:"tomato",strokeWidth:6},"standoffmark-".concat(t,"-1"))),r.push((0,l.jsx)("line",{x1:c+u,y1:s-u,x2:c-u,y2:s+u,stroke:"tomato",strokeWidth:6},"standoffmark-".concat(t,"-2"))),e.attemptedMoves.forEach((function(e){var t=(0,n.Z)(e,2),i=t[0],o=t[1];r.push(K(b.MOVE,k.Z.MOVE_FAILED,"unit",i,"territory",o))}))}}))}(a,o),(0,l.jsx)("g",{id:"arrows",children:a})},rr=i.forwardRef((function(r,e){var t=r.units,n=r.phase,i=r.orders,o=r.maps,a=r.territories,c=r.centersByProvince,s=r.standoffs,u=r.isLivePhase;return(0,l.jsxs)("svg",{id:"map",fill:"none",ref:e,style:{width:"100%",height:"100%"},xmlns:"http://www.w3.org/2000/svg",children:[(0,l.jsx)("g",{id:"full-map-svg",children:(0,l.jsxs)("g",{id:"container",children:[(0,l.jsx)(T,{units:t,centersByProvince:c,phase:n,isLivePhase:u}),(0,l.jsx)($,{orders:i,units:t,maps:o,territories:a,standoffs:s}),u&&(0,l.jsx)(Y,{}),u&&(0,l.jsx)(z,{units:t})]})}),(0,l.jsxs)("defs",{children:[(0,l.jsx)("pattern",{id:"capturable-land",patternUnits:"userSpaceOnUse",width:"1546",height:"1384",children:(0,l.jsx)("image",{href:w,x:"0",y:"0",width:"1546",height:"1384"})}),(0,l.jsx)("pattern",{id:"sea-texture",patternUnits:"userSpaceOnUse",width:"1546",height:"1384",children:(0,l.jsx)("image",{href:j,x:"0",y:"0",width:"1966",height:"1615"})}),B(),(0,l.jsxs)("pattern",{id:"neutral-land-texture",width:"30",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:[(0,l.jsx)("rect",{x:"0",y:"0",width:"30",height:"10",style:{fill:"#C5BFBE"}}),(0,l.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"#B5AFAE",strokeWidth:30}})]}),(0,l.jsxs)("filter",{id:"selectionGlow",height:"120%",width:"120%",x:"-10%",y:"-10%",children:[(0,l.jsx)("feMorphology",{operator:"dilate",radius:"5",in:"SourceAlpha",result:"thickerSource"}),(0,l.jsx)("feGaussianBlur",{stdDeviation:"8",in:"thickerSource",result:"blurredSource"}),(0,l.jsx)("feFlood",{floodColor:"rgb(100,200,255)",result:"glowColor"}),(0,l.jsx)("feComposite",{in:"glowColor",in2:"blurredSource",operator:"in",result:"selectionGlowGlow"})]}),(0,l.jsxs)("filter",{id:"choiceGlow",height:"120%",width:"120%",x:"-10%",y:"-10%",children:[(0,l.jsx)("feMorphology",{operator:"dilate",radius:"1",in:"SourceAlpha",result:"thickerSource"}),(0,l.jsx)("feGaussianBlur",{stdDeviation:"6",in:"thickerSource",result:"blurredSource"}),(0,l.jsx)("feFlood",{floodColor:"rgb(255,255,255)",result:"glowColor"}),(0,l.jsx)("feComposite",{in:"glowColor",in2:"blurredSource",operator:"in",result:"choicesGlowGlow"})]})]})]})})),er=i.memo(rr),tr=t(3622),nr=t(8539),ir={DESKTOP:[.45,3],MOBILE_LG:[.32,1.6],MOBILE_LG_LANDSCAPE:[.3,1.6],MOBILE:[.32,1.6],MOBILE_LANDSCAPE:[.27,1.6],TABLET:[.6275,3],TABLET_LANDSCAPE:[.6,3]},or=function(r){var e=r.units,t=r.phase,a=r.orders,u=r.maps,d=r.territories,h=r.centersByProvince,f=r.isLivePhase,v=r.standoffs,y=i.useRef(null),p=(0,tr.Z)(),m=(0,n.Z)(p,1)[0],x=(0,s.T)(),D=(0,s.C)(c.mT),I=function(r){return ir[r]}((0,nr.Z)(m)),g=(0,n.Z)(I,2),Z=g[0],O=g[1];return i.useLayoutEffect((function(){if(y.current){var r=o.Ys(y.current),e=r.select("#container"),t=function(r,e,t,n){var i=t,o=r.height*t;o<n.height&&(i=t+(1-o/n.height));var a,c=e.height*i,s=e.y*i,l=e.width*i,u=e.x*i,d=Math.abs(n.width-l),h=Math.abs(d/2),f=Math.abs(n.height-c),v=Math.abs(f/2),y=(r.y+r.height-(e.y+e.height))*i;return n.height>=c?(a=-s+v,v>y&&(a+=v-y)):a=-s-v,{scale:i,x:n.width>=l?-u+h:-u-h,y:a}}(e.node().getBBox(),r.select("#playableProvinces").node().getBBox(),Z,m),n=t.scale,i=t.x,a=t.y,c=o.sPX().translateExtent([[0,0],[6010,3005]]).scaleExtent([n,O]).clickDistance(3).on("zoom",(function(r){var t=r.transform;e.attr("transform",t)}));r.on("wheel",(function(r){return r.preventDefault()})).call(c).call(c.transform,o.CRH.translate(i,a).scale(n)).on("dblclick.zoom",null)}}),[y,m]),i.useEffect((function(){setTimeout((function(){x(c.I9.updateOrdersMeta(D))}),500)}),[]),i.useEffect((function(){var r=function(r){27===(r.which||r.keyCode)&&(r.preventDefault(),x(c.I9.resetOrder()))};return window.addEventListener("keydown",r),function(){return window.removeEventListener("keydown",r)}})),(0,l.jsx)("div",{style:{width:m.width,height:m.height},children:(0,l.jsx)(er,{ref:y,units:e,phase:t,orders:a,maps:u,territories:d,centersByProvince:h,standoffs:v,isLivePhase:f})})}}}]);
//# sourceMappingURL=504.69b5b4f6.chunk.js.map